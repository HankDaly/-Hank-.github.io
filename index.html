<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="记录学习的过程，关于代码、书籍、人生的感悟。">
<meta name="keywords" content="代码 书籍 感悟">
<meta property="og:type" content="website">
<meta property="og:title" content="Hank&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hank&#39;s Blog">
<meta property="og:description" content="记录学习的过程，关于代码、书籍、人生的感悟。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hank&#39;s Blog">
<meta name="twitter:description" content="记录学习的过程，关于代码、书籍、人生的感悟。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Hank's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hank's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I See Fire</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/13/通过卷积神经网络识别方正教务系统验证码实现自动登录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hank">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hank's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/13/通过卷积神经网络识别方正教务系统验证码实现自动登录/" itemprop="url">通过卷积神经网络识别方正教务系统验证码实现自动登录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-13T18:13:06+08:00">
                2018-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h1>通过卷积神经网络识别正方教务系统验证码</h1><p></p>
<p></p><h2>前言:</h2><p></p>
<p></p><p>我们学校的的教务系统每次在可以查成绩的时候崩溃，需要刷个几百遍才能登录。正好最近练习爬虫，借助网上的cnn模板来破解学校的验证码，以后就可以自动查询啦。当别人还在苦恼登陆失败的时候，我早已得知挂科的真相流下了痛苦的泪水…ORZ。</p><p></p>
<p></p><h2>什么是卷积神经网络？</h2><p></p>
<p></p><p>我不打算讲有关卷积神经网络的具体推算方法以及数学上面的东西，因为网络上面已经有足够好的资源，我会在下面把自己学习的链接贴一下。我想说的是作为一个初学者，如何将这个东西拿来用。“使用”与“精通”之间有很大区别。</p><p></p>
<p></p><h3>如何理解神经网络</h3><p></p>
<p></p><p>借用吴军老师的话:</p><p></p>
<p><blockquote><br>神经网络与人脑没有半点关系，它的本质是有向图。<br>不过它与一般的有向图有点区别<br>1、在人工神经网络中，所有的节点都是分层的，每层节可以通过有向弧指向上一层节点，<br>但是同级之间没有弧连接，而且不能越过上层直接连接到上上层。<br>2、每一条弧有一个值（称为权重和权值），根据这些值，可以计算出他们的下一个层的值。<br>人工神经网络就是上述的数学模型，它擅长的是模型分类。<br>在人工神经网络中，需要设计的部分只有俩个，一个是它的结构，即网络分成几层、每层<br>几个节点、节点之间如何连接：第二就是他们的计算函数的设计。<br>那么如何得到好的权值呢，这就要涉及到对人工神经网络的训练了。<br>训练神经网络主要依靠数据来对参数用梯度下降的方法找最优解。<br></blockquote><br><img src="http://hankdaly.github.io/images/cnn_1.jpg"></p>
<p></p><p>假设在一个二维空间中，我们需要区分a与e区域，它们的分布如上图所示。我们这个模型的任务就是要在空间里切一刀，将a和e分开。上图中的虚线便是分割线，左边是a，右边是e，如果新的元素进来了，落到左边我们就将它判断成a，反之则被认为是e。现在可以用一个人工神经网络来实现这个简单的分类器（虚线），该网络的结构如下：</p><br><img src="http://hankdaly.github.io/images/cnn_2.jpg"><p></p>
<p></p><p>这是一个再简单不过的人工神经网络了。在这个人工神经网络中，有两个输入节点：X₁和X₂，一个输出节点Y。在X₁到Y的弧上，我们赋予一个权重W₁ = 3，在从X₂到Y的弧上，我们赋予权重W₂ = -1,然后将Y这一点上的数值设定为两个输入节点数值X₁和X₂的一种线性组合，即y = 3X₁ - X₂。注意上面的函数是一个线性函数，他也可以被看成是输入向量(X₁,X₂)和(指向Y的)各条有向弧的权重向量(W₁,W₂)的内积(也叫做点积)。为了后面判断时方便起见、不妨在公式中再加一个常数项-2，即</p><p></p>
<p></p><p>y = 3X₁ - X₂ - 2</p><p></p>
<p></p><p>现在将平面上面的一些点(0.5,1)、(2,2)、(1,-1)和(-1,-1)的坐标输入到第一层的两个节点上，然后看看在输出节点得到了什么值。</p><br><img src="http://hankdaly.github.io/images/cnn_3.jpg"><p></p>
<p>&lt;table frame=”above”</p>
<p><caption>人工神经网络四个不同的输入值和在输出端对应的输出值</caption><br>    <tr><br>        <th>输入值(X₁,X₂)</th><br>        <th>输出值y</th><br>    </tr><br>    <tr><br>        <td>(0.5,1)</td><br>        <td>-1.5</td><br>    </tr><br>    <tr><br>        <td>(2,2)</td><br>        <td>2</td><br>    </tr><br>    <tr><br>        <td>(1,-1)</td><br>        <td>2</td><br>    </tr><br>    <tr><br>        <td>(-1,-1)</td><br>        <td>-4</td><br>    </tr><br></p>
<p></p><p>于是就可以说，如果在输出的节点Y得到的值大于零，那么这个点就属于e类，反之则属于a类。我们用神经网络定义了一个线性分类器，它可以做到简单的任务。</p><p></p>
<p></p><p style="font-style:italic"><br>上述例子摘自吴军老师的《数学之美》<br></p><p></p>
<p></p><h3>CNN</h3><p></p>
<p></p><p>关于cnn，它属于神经网络的一种，所以拥有上述神经网络的特性，它是特殊的有向图，它是一个关于图像的分类器。</p><p></p>
<p></p><p>关于cnn的工作原理我推荐一篇文章，其中很详细的阐述了cnn的原理。</p><a href="https://www.jianshu.com/p/fe428f0b32c1" target="_blank" rel="noopener">透析卷积神经网络</a><p></p>
<p></p><h2>如何实现</h2><p></p>
<p></p><p>原理就说到这儿了，那么用什么工具实现呢？我使用的是谷歌的开源人工智能系统<br><a href="https://www.tensorflow.org/" target="_blank" rel="noopener">TensorFlow</a>。前面说过了人工神经网络其实就是有向图，那么TensorFlow其实就是搭建有向图的工具，具体的使用方法请查看官方文档，英文学渣(就是本人)可以看<a href="http://docs.pythontab.com/tensorflow/" target="_blank" rel="noopener">TensorFlow中文文档</a></p><p></p>
<p></p><h2>训练代码CNN部分</h2><p></p>
<p></p><p>处理文件的方法用的是<a href="http://blog.topspeedsnail.com/archives/10858" target="_blank" rel="noopener">斗大的熊猫博客</a>例子，CNN框架以及参数来自知乎一篇专栏。</p><p></p>
<p><pre><br>def crack_captcha_cnn(w_alpha=0.01, b_alpha=0.1):</pre></p>
<pre><code># 将占位符 转换为 按照图片给的新样式
x = tf.reshape(X, shape=[-1, IMAGE_HEIGHT, IMAGE_WIDTH, 1])  # [占位, H, W, 灰度为1]

# 3 conv layer
w_c1 = tf.Variable(w_alpha * tf.random_normal([3, 3, 1, 32]))  # 从正太分布输出随机值      卷积窗口3*3
b_c1 = tf.Variable(b_alpha * tf.random_normal([32]))
conv1 = tf.nn.relu(tf.nn.bias_add(tf.nn.conv2d(x, w_c1, strides=[1, 1, 1, 1], padding=&apos;SAME&apos;), b_c1))  # 卷积过程   H, W上滑动的步长  让卷积的输入和输入保持同样的尺寸
conv1 = tf.nn.max_pool(conv1, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=&apos;SAME&apos;)  # 因为希望整体上缩小图片尺寸，因此池化层的strides也设为横竖两个方向上以2为步长。
conv1 = tf.nn.dropout(conv1, keep_prob)

w_c2 = tf.Variable(w_alpha * tf.random_normal([3, 3, 32, 64]))
b_c2 = tf.Variable(b_alpha * tf.random_normal([64]))
conv2 = tf.nn.relu(tf.nn.bias_add(tf.nn.conv2d(conv1, w_c2, strides=[1, 1, 1, 1], padding=&apos;SAME&apos;), b_c2))
conv2 = tf.nn.max_pool(conv2, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=&apos;SAME&apos;)
conv2 = tf.nn.dropout(conv2, keep_prob)

w_c3 = tf.Variable(w_alpha * tf.random_normal([3, 3, 64, 64]))
b_c3 = tf.Variable(b_alpha * tf.random_normal([64]))
conv3 = tf.nn.relu(tf.nn.bias_add(tf.nn.conv2d(conv2, w_c3, strides=[1, 1, 1, 1], padding=&apos;SAME&apos;), b_c3))
conv3 = tf.nn.max_pool(conv3, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding=&apos;SAME&apos;)
conv3 = tf.nn.dropout(conv3, keep_prob)

# Fully connected layer 全连接层
w_d = tf.Variable(w_alpha * tf.random_normal([9 * 4 * 64, 1024]))       # 隐含节点
b_d = tf.Variable(b_alpha * tf.random_normal([1024]))
dense = tf.reshape(conv3, [-1, w_d.get_shape().as_list()[0]])
dense = tf.nn.relu(tf.add(tf.matmul(dense, w_d), b_d))
dense = tf.nn.dropout(dense, keep_prob)

w_out = tf.Variable(w_alpha * tf.random_normal([1024, MAX_CAPTCHA * CHAR_SET_LEN]))
b_out = tf.Variable(b_alpha * tf.random_normal([MAX_CAPTCHA * CHAR_SET_LEN]))
out = tf.add(tf.matmul(dense, w_out), b_out)
return out
</code></pre><p></p>
<p></p><p>关于训练量，总共从官网爬了1500张下来，人眼识别了一下午（吐血）。成功率大概50%，我在登陆程序上让它自己迭代，失败就继续尝试访问，问题不大。</p><p></p>
<p></p><p>下面贴一下神经网络的相关学习链接</p><a href="https://www.bilibili.com/video/av16001891/" target="_blank" rel="noopener">莫烦的人工神经网络教程</a><br><br><a href="https://edu.hellobi.com/course/189" target="_blank" rel="noopener">Hellobi Live的人工神经网络的教程<br><br><a href="http://colah.github.io/" target="_blank" rel="noopener">colah’s blog</a><p></p>
<p></p><h2>登陆教务系统</h2><p></p>
<p></p><p>模型训练完了，下一步就是实现自动登陆了。</p><p></p>
<p></p><h3>难点</h3><p></p>
<p></p><p>1.方正教务系统在提交表单的时候除了必要的学号密码等等，还需要提交一个<strong>VIEWSTATE值。解决方法就是先get一次，获取到</strong>VIEWSTATE值，再post。</p><p></p>
<p></p><p>2.方正教务系统在早上的url中会带有一串乱码字母，每次get网站这串字母都会变。需要保持验证码的地址和get的地址都带有一样的乱码，这样验证码才能与地址吻合。</p><p></p>
<p></p><p>3.登录成功后将会对登录界面进行一次get，用来获取成绩界面的__VIEWSTATE值，这次get必须带有表头,表头中的Referer要带有学号。这很关键。</p><p></p>
<p></p><h3>登录代码</h3><p></p>
<p><pre><br>import os<br>import os.path<br>import bs4<br>import requests<br>from bs4 import BeautifulSoup<br>import sys<br>from clear_up import clear<br>from request_change import ne_code<br>import random<br>import re<br>import shutil<br>import tensorflow as tf<br>import numpy as np<br>import tim<br>from deal_image import im_deal<br>from train_tf import convert2gray<br>from train_tf import vec2text<br>from train_tf import MAX_CAPTCHA<br>from train_tf import CHAR_SET_LEN<br>from train_tf import X<br>from train_tf import keep_prob<br>from train_tf import crack_captcha_cnn<br>from PIL import Image<br>import importlib<br>importlib.reload(sys)</pre></p>
<p>n_cod = ne_code()<br>studentnumber = “0”<br>password = “0”<br>def students_message():<br>    studentnumber = str(input(‘请输入你的学号’))<br>    password = str(input(‘请输入你的密码’))<br>    return studentnumber,password</p>
<p>#定义new_code函数，实时反馈验证码<br>def new_code(r):<br>    if re.search(r”\w{24}”,r) == None:<br>        print(“no”)<br>        new_url = “/“<br>        return new_url<br>    new = re.search(r”\w{24}”,r).group()<br>    new_url = str(“(“+new+”)”)<br>    return new_url</p>
<p>#定义get_headers函数，可以将复制下来的Headers分成字典<br>def getHeaders(raw_head):<br>    headers={}<br>    for raw in raw_head.split(‘\n’):<br>        headerKey = raw.split(‘:’,1)[0]<br>        headerValue = raw.split(‘:’,1)[1]<br>        headers[headerKey]=headerValue<br>    return headers</p>
<p>#登录时的Header<br>login_head = ‘’’Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8<br>Accept-Encoding:gzip, deflate<br>Accept-Language:zh-CN,zh;q=0.9<br>Cache-Control:max-age=0<br>Content-Length:201<br>Content-Type:application/x-www-form-urlencoded<br>Host:122.225.19.20<br>Origin:<a href="http://122.225.19.20" target="_blank" rel="noopener">http://122.225.19.20</a><br>Proxy-Connection:keep-alive<br>Referer:<a href="http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&#39;&#39;&#39;default2.aspx" target="_blank" rel="noopener">http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&#39;&#39;&#39;default2.aspx</a><br>Upgrade-Insecure-Requests:1<br>User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36’’’</p>
<p>#构建get的表单，这里很关键<br>get_headers = ‘’’Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8<br>Accept-Encoding:gzip, deflate<br>Accept-Language:zh-CN,zh;q=0.9<br>Host:122.225.19.20<br>Proxy-Connection:keep-alive<br>Referer:<a href="http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&quot;xs_main.aspx?xh=&quot;+studentnumber+&#39;&#39;&#39;" target="_blank" rel="noopener">http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&quot;xs_main.aspx?xh=&quot;+studentnumber+&#39;&#39;&#39;</a><br>Upgrade-Insecure-Requests:1<br>User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36’’’</p>
<p>#查询页面头部<br>mark_head = ‘’’Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8<br>Accept-Encoding:gzip, deflate<br>Accept-Language:zh-CN,zh;q=0.9<br>Cache-Control:max-age=0<br>Host:122.225.19.20<br>Proxy-Connection:keep-alive<br>Referer:<a href="http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&quot;xs_main.aspx?xh=&quot;+studentnumber+&#39;&#39;&#39;" target="_blank" rel="noopener">http://122.225.19.20/&#39;&#39;&#39;+n_cod+&quot;/&quot;+&quot;xs_main.aspx?xh=&quot;+studentnumber+&#39;&#39;&#39;</a><br>Upgrade-Insecure-Requests:1<br>User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36’’’</p>
<p>#输入我查表单获得的参数以及不变的参数（学号，密码）<br>url = “<a href="http://122.225.19.20/&quot;+n_cod" target="_blank" rel="noopener">http://122.225.19.20/&quot;+n_cod</a> #学校访问地址，表单中获得<br>imgurl = “<a href="http://122.225.19.20/&quot;+n_cod+&quot;/CheckCode.aspx&quot;" target="_blank" rel="noopener">http://122.225.19.20/&quot;+n_cod+&quot;/CheckCode.aspx&quot;</a> #验证码地址，checkcode中获得</p>
<p>output = crack_captcha_cnn()<br>saver = tf.train.Saver()<br>sess = tf.Session()<br>saver.restore(sess, “.model/crack_capcha.model-6900”)</p>
<p>#验证码识别<br>def crack_captcha(image,output,sess):</p>
<pre><code>image = convert2gray(image).flatten() / 255  # 一维化
predict = tf.argmax(tf.reshape(output, [-1, MAX_CAPTCHA, CHAR_SET_LEN]), 2)

text_list = sess.run(predict, feed_dict={X: [image], keep_prob: 1})

text = text_list[0].tolist()
vector = np.zeros(MAX_CAPTCHA * CHAR_SET_LEN)
i = 0
for n in text:
    vector[i * CHAR_SET_LEN + n] = 1
    i += 1

predict_text = vec2text(vector)
return predict_text
</code></pre><p>def login_in():</p>
<pre><code>#访问教务系统，获取__VIEWSTATE值、验证码
s = requests.Session()
response = s.get(url+&quot;/default2.aspx&quot;)
#用正则表达式匹配__VIEWSTAT值,或者直接用beautifulsoup找到valu的值，这里用了后者。
soup = BeautifulSoup(response.text,&quot;lxml&quot;)
__VIEWSTATE = soup.find(&quot;input&quot;,attrs={&apos;name&apos;:&apos;__VIEWSTATE&apos;}).get(&quot;value&quot;)
#获取验证码
imgresponse = s.get(imgurl,stream=True)
image = imgresponse.content
local = os.getcwd() #获取本文件的路径
filelocal = os.path.join(local,&quot;code.jpg&quot;) #验证码名为code
with open(filelocal,&quot;wb&quot;) as jpg:
    jpg.write(image) #将文件保存到本地

ps_image = im_deal(filelocal)  #处理验证码
fileps = os.path.join(local,&quot;code.bmp&quot;)
ps_image.save(fileps)
one_ps_image = np.array(Image.open(fileps))

code_text = crack_captcha(one_ps_image,output,sess)

#获得cnn识别后的验证码
code = code_text
print(code)
#数据都拿到后，构建post

data = {
&quot;RadioButtonList1&quot;:&apos;%D1%A7%C9%FA&apos;,
&quot;__VIEWSTATE&quot;:__VIEWSTATE,
&quot;txtUserName&quot;:studentnumber,
&quot;Textbox1&quot;:&quot;&quot;,
&quot;Textbox2&quot;:password,
&quot;txtSecretCode&quot;:code,
&quot;Button1&quot;:&quot;&quot;,
&quot;lbLanguage&quot;:&quot;&quot;,
&quot;hidPdrs&quot;:&quot;&quot;,
&quot;hidsc&quot;:&quot;&quot;
 }
#获取登录界面
headers = getHeaders(login_head)
#登录教务系统
res = s.post(url+&apos;/default2.aspx&apos;,data=data,headers=headers)

#登录成功
#获取验证码

#主页面
#获取成绩查询页面的url
headers = getHeaders(get_headers)
page = s.get(url+&quot;/xs_main.aspx?xh=&quot;+studentnumber,headers=headers)
print(url+&quot;/xs_main.aspx?xh=&quot;+studentnumber)
soup2 = BeautifulSoup(page.text,&apos;lxml&apos;)
markurl = soup2.find(&quot;a&quot;,attrs={&apos;onclick&apos;:&quot;GetMc(&apos;成绩查询&apos;);&quot;}).get(&quot;href&quot;)
print(markurl)


#获取头部
headers = getHeaders(mark_head)
#表单
mark_data = {
&quot;__EVENTTARGET&quot;:&quot;&quot;,
&quot;__EVENTARGUMENT&quot;:&quot;&quot;,
&quot;__VIEWSTATE&quot;:&quot;&quot;,
&quot;hidLanguage&quot;:&quot;&quot;,
&quot;ddlXN&quot;:&quot;&quot;,
&quot;ddlXQ&quot;:&quot;&quot;,
&quot;ddl_kcxz&quot;:&quot;&quot;,
&quot;btn_zcj&quot;:u&quot;历年成绩&quot;.encode(&apos;gb2312&apos;,&apos;replace&apos;)
}
#获取__VIEWSTATE
markpage = s.get(url+&quot;/&quot;+markurl,headers=headers)
soup3 = BeautifulSoup(markpage.text,&quot;lxml&quot;)
__VIEWSTATE = soup3.find(&quot;input&quot;,attrs={&apos;name&apos;:&apos;__VIEWSTATE&apos;}).get(&quot;value&quot;)
mark_data[&apos;__VIEWSTATE&apos;]=__VIEWSTATE

#提交表单，获取成绩界面
markpage = s.post(url+&quot;/&quot;+markurl,mark_data,headers=headers)
soup4 = BeautifulSoup(markpage.text,&apos;lxml&apos;)

marktable = str(soup4.find_all(id=&quot;Datagrid1&quot;)[0])
marklist =  clear(marktable)
return marklist
</code></pre><p>def deal_marklist(marklist):<br>    for line in marklist:<br>            for column in [0,1,3,4,6,7,8]:<br>                print(‘%-20s’ % line[column],end = ‘’)<br>            print(“”)</p>
<p>def error():<br>    global boom<br>    try:<br>        boom = login_in()<br>    except AttributeError as e:<br>        print(“验证失败”)<br>        error()</p>
<p>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    studentnumber,password = students_message()<br>    boom = []<br>    error()<br>    deal_marklist(boom)<br></p>
<p></p><p>关于验证码的处理模块，我自己用PIL对验证码进行了一个预处理，将图像二值化并且去掉了噪点，我会在最下面将自己的代码分享</p><p></p>
<p></p><p>贴一下成功后的截图~~</p><br><img src="http://hankdaly.github.io/images/cnn_4.jpg"><p></p>
<p></p><p>可以看到失败一次后继续访问，然后就登录成功了</p><p></p>
<p></p><h2>最后</h2><p></p>
<p></p><p>在对神经网络的学习过程中，感到数学的力量真的是强大的。数学家们用非常简洁的数学模型确能形成如此复杂的系统，从而揭示规律。然而数学也是艰涩的，我在查看文档资料的时候充分认识到自己数学的薄弱。但是如果一头扎进数学的海洋，我可能就不能在短时间内解决教务系统自动登陆的问题了。在今后的实践中肯定也有这种问题出现，知识具有层级结构，在深入多少层后停止，将剩余看做黑箱是需要思考的。目前我想遵循的原则是AK47原则，简单、杀伤大：也就是说用最简单的方法达到目的。</p>
<p></p><p>这是这个项目的仓库，可以在<a href="https://github.com/HankDaly/school" target="_blank" rel="noopener">这里</a>找到所有代码</p><p></p>
</a>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Hank</p>
              <p class="site-description motion-element" itemprop="description">记录学习的过程，关于代码、书籍、人生的感悟。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hank</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
